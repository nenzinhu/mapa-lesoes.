<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa de Lesões</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #f0f2f5;
  margin: 0;
  padding: 10px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
}

#membro-body {
  width: 100%;
  max-width: 280px;
  height: 420px;
  margin: auto;
}

.membro {
  fill: #d1d1d1;
  stroke: #fff;
  stroke-width: 2;
  cursor: pointer;
}

.selecionado {
  fill: #ff4d4d !important;
}

select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h3>Local da lesão</h3>

  <svg id="membro-body" viewBox="0 0 200 500">
    <circle id="Cabeça" class="membro" cx="100" cy="40" r="30"/>
    <rect id="Tronco" class="membro" x="60" y="80" width="80" height="150"/>
    <rect id="Braço_Esquerdo" class="membro" x="20" y="85" width="30" height="130"/>
    <rect id="Braço_Direito" class="membro" x="150" y="85" width="30" height="130"/>
    <rect id="Perna_Esquerda" class="membro" x="65" y="240" width="30" height="160"/>
    <rect id="Perna_Direita" class="membro" x="105" y="240" width="30" height="160"/>
  </svg>

  <select id="tipo-lesao">
    <option value="">Selecione o tipo</option>
    <option value="Escoriação">Escoriação</option>
    <option value="Corte/Laceração">Corte / Laceração</option>
    <option value="Contusão">Contusão</option>
    <option value="Fratura Suspeita">Fratura (suspeita)</option>
    <option value="Dor Local">Dor local</option>
  </select>
</div>

<div class="card">
  <h3>Texto para relato policial</h3>
  <textarea id="texto-relato" rows="7" readonly></textarea>
  <button onclick="copiarRelato()">Copiar texto</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let membroAtual = null;
const lesoes = {};

const menuTipo = document.getElementById('tipo-lesao');
const textoRelato = document.getElementById('texto-relato');

// Clique no corpo
document.querySelectorAll('.membro').forEach(el => {
  el.addEventListener('click', () => {
    membroAtual = el.id.replace('_', ' ');
    menuTipo.style.display = 'block';
  });
});

// Seleção do tipo
menuTipo.addEventListener('change', () => {
  if (menuTipo.value && membroAtual) {
    lesoes[membroAtual] = menuTipo.value;
    document.getElementById(membroAtual.replace(' ','_')).classList.add('selecionado');
    gerarTextoRelato();
    menuTipo.value = '';
  }
});

// TEXTO FINAL POLICIAL
function gerarTextoRelato() {
  let frases = [];

  const locais = {
    'Cabeça': 'na região da cabeça',
    'Tronco': 'na região do tronco',
    'Braço Esquerdo': 'no braço esquerdo',
    'Braço Direito': 'no braço direito',
    'Perna Esquerda': 'na perna esquerda',
    'Perna Direita': 'na perna direita'
  };

  for (const [local, tipo] of Object.entries(lesoes)) {
    const regiao = locais[local];

    switch (tipo) {

      case 'Escoriação':
        frases.push(`apresentava escoriações aparentes ${regiao}.`);
        break;

      case 'Corte/Laceração':
        frases.push(`apresentava lesão aparente ${regiao}, com sangramento visível.`);
        break;

      case 'Contusão':
        frases.push(`apresentava lesão aparente ${regiao}.`);
        break;

      case 'Fratura Suspeita':
        frases.push(`relatava fortes dores ${regiao}, não sendo possível precisar a gravidade da lesão.`);
        break;

      case 'Dor Local':
        frases.push(`relatava sentir dores ${regiao}.`);
        break;
    }
  }

  textoRelato.value =
    frases.length > 0
      ? `Durante atendimento no local, foi possível observar que a vítima ${frases.join(' ')}`
      : '';
}

function copiarRelato() {
  textoRelato.select();
  document.execCommand('copy');
  alert('Texto copiado para o relato.');
}
</script>

</body>
</html>

