<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa de Lesões</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  background: #f0f2f5;
  margin: 0;
  padding: 10px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
}

#membro-body {
  position: relative;
  width: 280px;
  height: 560px;
  margin: auto;
  background: url("pessoa.png") no-repeat center;
  background-size: contain;
}

/* áreas invisíveis de referência */
.membro {
  position: absolute;
  cursor: crosshair;
}

/* ponto vermelho preciso */
.marcador {
  position: absolute;
  width: 14px;
  height: 14px;
  background: red;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  box-shadow: 0 0 4px rgba(0,0,0,0.4);
}

select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h3>Local da lesão</h3>

  <div id="membro-body">

    <div id="Cabeça" class="membro"
      style="top:20px; left:95px; width:90px; height:90px;"></div>

    <div id="Tronco" class="membro"
      style="top:120px; left:80px; width:120px; height:170px;"></div>

    <div id="Costas" class="membro"
      style="top:140px; left:85px; width:110px; height:190px;"></div>

    <div id="Braço_Esquerdo" class="membro"
      style="top:135px; left:30px; width:50px; height:180px;"></div>

    <div id="Braço_Direito" class="membro"
      style="top:135px; left:200px; width:50px; height:180px;"></div>

    <div id="Perna_Esquerda" class="membro"
      style="top:310px; left:90px; width:50px; height:210px;"></div>

    <div id="Perna_Direita" class="membro"
      style="top:310px; left:140px; width:50px; height:210px;"></div>

    <div id="Pé_Esquerdo" class="membro"
      style="top:525px; left:85px; width:50px; height:30px;"></div>

    <div id="Pé_Direito" class="membro"
      style="top:525px; left:140px; width:50px; height:30px;"></div>

  </div>

  <select id="tipo-lesao">
    <option value="">Selecione o tipo da lesão</option>
    <option value="Escoriação">Escoriação</option>
    <option value="Corte/Laceração">Corte / Laceração</option>
    <option value="Contusão">Contusão</option>
    <option value="Fratura Suspeita">Fratura (suspeita)</option>
    <option value="Dor Local">Dor local</option>
  </select>
</div>

<div class="card">
  <h3>Texto para relato policial</h3>
  <textarea id="texto-relato" rows="7" readonly></textarea>
  <button onclick="copiarRelato()">Copiar texto</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const corpo = document.getElementById('membro-body');
const menuTipo = document.getElementById('tipo-lesao');
const textoRelato = document.getElementById('texto-relato');

let membroAtual = null;
let marcadorAtual = null;
const lesoes = [];

// CLIQUE → JÁ FICA VERMELHO
document.querySelectorAll('.membro').forEach(el => {
  el.addEventListener('click', (e) => {
    e.stopPropagation();

    membroAtual = el.id.replace('_', ' ');

    const rect = corpo.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const marcador = document.createElement('div');
    marcador.className = 'marcador';
    marcador.style.left = x + 'px';
    marcador.style.top = y + 'px';
    corpo.appendChild(marcador);

    marcadorAtual = marcador;
    menuTipo.value = '';
  });
});

// DEPOIS SELECIONA O TIPO
menuTipo.addEventListener('change', () => {
  if (!menuTipo.value || !membroAtual || !marcadorAtual) return;

  lesoes.push({
    local: membroAtual,
    tipo: menuTipo.value
  });

  gerarTextoRelato();

  marcadorAtual = null;
  menuTipo.value = '';
});

// TEXTO DO RELATO
function gerarTextoRelato() {
  const locais = {
    'Cabeça': 'na região da cabeça',
    'Tronco': 'na região do tronco',
    'Costas': 'na região das costas',
    'Braço Esquerdo': 'no braço esquerdo',
    'Braço Direito': 'no braço direito',
    'Perna Esquerda': 'na perna esquerda',
    'Perna Direita': 'na perna direita',
    'Pé Esquerdo': 'no pé esquerdo',
    'Pé Direito': 'no pé direito'
  };

  const frases = lesoes.map(l => {
    const r = locais[l.local];
    switch (l.tipo) {
      case 'Escoriação': return `apresentava escoriações aparentes ${r}.`;
      case 'Corte/Laceração': return `apresentava lesão aparente ${r}, com sangramento visível.`;
      case 'Contusão': return `apresentava lesão aparente ${r}.`;
      case 'Fratura Suspeita': return `relatava fortes dores ${r}, não sendo possível precisar a gravidade da lesão.`;
      case 'Dor Local': return `relatava sentir dores ${r}.`;
    }
  });

  textoRelato.value = frases.length
    ? `Durante atendimento no local, foi possível observar que a vítima ${frases.join(' ')}`
    : '';
}

function copiarRelato() {
  textoRelato.select();
  document.execCommand('copy');
  alert('Texto copiado para o relato.');
}
</script>

</body>
</html>
